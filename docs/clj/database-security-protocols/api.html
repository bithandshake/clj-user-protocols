<!DOCTYPE html>
<html><html><head><style type="text/css">body{margin:0 0 0 560px;padding:60px 48px}div{box-sizing:border-box}pre{display:block;margin:0;letter-spacing:.8px}.scroll-x{overflow-x:auto}.scroll-y{flex-grow:1;overflow-y:auto}a,a:active,a:hover,a:visited{display:block;text-decoration:none}a.inline-link{display:inline-block}a.inline-link:hover{text-decoration:underline}.button{font-size:13px;letter-spacing:.5px;line-height:18px;padding:3px 12px;white-space:inherit}.button:hover{background-color:#f0f0f0}.button--active{background-color:#f3f3f3}.button--active:hover{background-color:#f0f0f0}.text--xs{font-size:10px;line-height:24px;text-transform:uppercase}.text--s{font-size:12px;line-height:18px}.text--m{font-size:13px;line-height:18px}.text--l{font-size:14px;line-height:18px}.text--semi-bold{font-weight:500}.text--bold{font-weight:600}.text--wrap{-white-space:normal;white-space:pre-wrap}.color--basic{color:#303030}.color--primary{color:#0088cc}.color--secondary{color:#8800cc}.color--muted{color:#606060}.color--warning{color:#cc00aa}.collapsible-wrapper{display:flex;flex-direction:column}.collapsible-button{cursor:pointer;position:relative;user-select:none;width:fit-content}.collapsible-button:hover{color:#888}.collapsible-button::after{align-items:center;content:'▼';display:flex;font-size:8px;justify-content:center;position:absolute;height:24px;right:-24px;top:0;width:24px}.collapsible-wrapper[data-expanded="true"] .collapsible-button::after{content:'▲'}.collapsible-wrapper .collapsible-content{display:none}.collapsible-wrapper[data-expanded="true"] .collapsible-content{display:block}#top-bar{background-color:#ffffff;border-bottom:1px solid #e0e0e0;display:flex;gap:6px;height:60px;left:0;padding-left:18px;position:fixed;top:0;width:100%}#top-bar--library-uri{font-size:12px;line-height:60px;padding:0 18px;position:absolute;right:0;top:0}#top-bar--library-uri:hover{background-color:#f0f0f0}#top-bar--library-name{font-size:18px;line-height:60px;text-transform:uppercase}#top-bar--author-name{font-size:12px}#top-bar--library-version{font-size:12px;line-height:18px;margin-top:12px}#bottom-bar{background-color:white;border-top:1px solid #e0e0e0;bottom:0;display:flex;justify-content:right;left:0;position:fixed;width:100%}#bottom-bar--credits-link{color:#aa55bb;font-size:12px;letter-spacing:.8px;line-height:42px;padding:0 18px}#bottom-bar--credits-link:hover{background-color:#f0f0f0}#primary-list{background-color:#fff;border-right:1px solid #e0e0e0;display:flex;flex-direction:column;height:calc(100vh - 60px);left:0;padding:12px 0 54px 0;position:fixed;top:60px;width:280px}#secondary-list{background-color:#fff;border-right:1px solid #e0e0e0;display:flex;flex-direction:column;height:calc(100vh - 60px);left:280px;padding:12px 0 54px 0;position:fixed;top:60px;width:280px}#primary-list,#secondary-list{z-index:9999}#primary-list .text--xs,#secondary-list .text--xs{padding-left:12px}.primary-list--container,.secondary-list--container{margin-bottom:12px}#namespace-header--title{font-size:18px;line-height:24px;margin-top:24px}#declarations{display:flex;flex-direction:column}.declaration--wrapper{padding-top:96px}.declaration--name{border-bottom:1px solid #e0e0e0;font-size:18px;line-height:18px;padding-bottom:8px;margin-bottom:12px}.tutorial--wrapper{padding-top:96px}.tutorial--name{border-bottom:1px solid #e0e0e0;font-size:18px;line-height:18px;padding-bottom:8px;margin-bottom:12px}.content-blocks{display:flex;flex-direction:column}.content-block--separator{height:12px}.content-block--label{display:flex;gap:4px;line-height:24px}.content-block--preview-image{border:1px solid #dedede;display:block;max-height:480px;max-width:640px;min-height:48px;min-width:64px}.content-block--boxed{background-color:#fafafa;color:#333;padding:12px 8px}</style><script type="text/javascript">function toggleCollapsible(collapsibleId){collapsible=document.getElementById(collapsibleId);if(collapsible.dataset.expanded==='true'){collapsible.dataset.expanded='false';}else{collapsible.dataset.expanded='true';}}</script></head><body><div id="primary-list"><div class="scroll-y"><div class="primary-list--container"><pre class="color--muted text--xs">Clojure namespaces</pre><a href="https://mt-app-kit.github.io/clj-security-protocols/clj/database-security-protocols/api.html"><pre class="button color--primary button--active">database-security-protocols.api</pre></a><a href="https://mt-app-kit.github.io/clj-security-protocols/clj/media-security-protocols/api.html"><pre class="button color--primary ">media-security-protocols.api</pre></a><a href="https://mt-app-kit.github.io/clj-security-protocols/clj/user-security-protocols/api.html"><pre class="button color--primary ">user-security-protocols.api</pre></a></div></div></div><div id="secondary-list"><div class="scroll-y"><div class="secondary-list--container"><pre class="text--xs color--muted">Declarations</pre><a href="#get-data"><pre class="button color--primary">get-data</pre></a><a href="#remove-data"><pre class="button color--primary">remove-data</pre></a><a href="#store-data"><pre class="button color--primary">store-data</pre></a></div></div></div><div id="namespace-header"><pre class="text--bold" id="namespace-header--title">database-security-protocols.api</pre><pre class="color--muted text--xs">Clojure namespace</pre></div><div id="tutorials--wrapper"><div id="tutorials"></div></div><div id="declarations--wrapper"><div id="declarations"><div class="declaration--wrapper" id="get-data"><pre class="color--muted text--xs">Declaration</pre><pre class="color--primary declaration--name text--bold">get-data</pre><div class="content-blocks"><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Important</pre></div><pre class="color--warning text--m text--wrap">This function is incomplete and may not behave as expected.</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Description</pre></div><pre class="color--basic text--m text--wrap">- Security protocol function for getting data from the database.<br>- For performing additional side effects use the 'additional-action-f' function.<br>- For implementing additional security levels use the 'additional-security-f' function.<br>- Performs various security checks before returns a HTTP response that indicates if any check has been failed or the action was successful.<br>- The data validating / manipulating functions are applied as a cascade where every function takes the data as it has returned from<br>  the previous function (except the first function that takes the initial data) and every function must return the validated / manipulated<br>  data in case of successful execution.<br>  Functions are applied in the following order:<br>  1. get-data-f<br>  2. data-valid-f<br>  3. prepare-data-f<br>  4. populate-data-f<br>  5. hide-sensitive-values-f<br>  6. parse-values-f<br>  7. unparse-values-f<br>  8. postpare-data-f</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">request</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs">required</pre></div></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">initial-data</pre><pre class="color--muted text--xs">*</pre><pre class="color--muted text--xs">optional</pre></div><pre class="color--muted text--s scroll-x">The 'initial-data' passed through the data validating / manipulating functions (that are applied as a cascade).<br>Default: NIL</pre></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">functions</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs">required</pre></div><pre class="color--muted text--s scroll-x">{:additional-action-f (function)(opt)<br>  Custom side-effect function that is applied if no security check has been failed.<br>  Must return TRUE in case of successful execution.<br> :additional-security-f (function)(opt)<br>  Custom security function that is applied after the built-in security checks.<br>  Must return TRUE in case of no security concern detected.<br> :client-rate-limit-exceeded-f (function)(opt)<br>  Must return TRUE if the client device / IP address is involved in too many attempts in a specific timeframe.<br> :data-valid-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if it's valid.<br> :get-data-f (function)(opt)<br>  Takes the provided 'initial-data' as its only argument.<br>  Must return the data if the execution was successful.<br> :hide-sensitive-values-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :parse-values-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :permission-granted-f (function)(opt)<br>  Must return TRUE if the user has permission to do the action.<br> :populate-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :postpare-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :prepare-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :unparse-values-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :user-rate-limit-exceeded-f (function)(opt)<br>  Must return TRUE if the user is involved in too many attempts in a specific timeframe.}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Usage</pre></div><pre class="text--s scroll-x content-block--boxed">(get-data {...} {...})</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Usage</pre></div><pre class="text--s scroll-x content-block--boxed">(get-data {...} {...} {...})</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--warning text--xs">Unknown syntax</pre></div><pre class="color--muted text--m scroll-x">{:type :example, :indent 1, :additional ["(get-data {...} {...} {...})" "=>" "{:body :too-many-requests/user-rate-limit-exceeded :status 429}"]}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--warning text--xs">Unknown syntax</pre></div><pre class="color--muted text--m scroll-x">{:type :example, :indent 1, :additional ["(defn my-route" "  [request]" "  (let [ip-address (-> request :remote-addr)" "        user-id    (-> request :session :user-id)]" "       (get-data request {:my-string \"My string\"}" "                         {:client-rate-limit-exceeded-f #(my-log-service/too-many-attempts-by-ip-address? ip-address)" "                          :data-valid-f                 #(and (map? %) %)" "                          :get-data-f                   #(my-database/get-data!             %)" "                          :parse-values-f               #(my-utils/parse-timestamps-in-data %)" "                          :populate-data-f              #(my-utils/add-user-related-values  %)" "                          :user-rate-limit-exceeded-f   #(my-log-service/too-many-attempts-by-user-id? user-id)})))" "=>" "{:body :performed-request/data-stored :status 200}"]}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Return</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs"></pre></div><pre class="color--muted text--s scroll-x">{:body (namespaced keyword)<br>  :forbidden-request/permission-denied<br>  (The user has no permission to do the action),<br>  :invalid-request/invalid-ip-address<br>  (No valid IP address has been found in the request),<br>  :invalid-request/invalid-user-agent<br>  (No valid user agent has been found in the request),<br>  :too-many-requests/client-rate-limit-exceeded<br>  (Too many actions have been attempted by the client device / IP address in a specific timeframe),<br>  :too-many-requests/user-rate-limit-exceeded<br>  (Too many actions have been attempted by the user in a specific timeframe),<br>  :unknown-error/additional-action-stage-failed<br>  (The additional action function returned a false value),<br>  :unknown-error/additional-security-stage-failed<br>  (The additional security function returned a false value)<br>  :server-error/unable-to-get-data<br>  (The 'get-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-hide-sensitive-values<br>  (The 'hide-sensitive-values-f' function has been returned a falsish value),<br>  :server-error/unable-to-parse-values<br>  (The 'parse-values-f' function has been returned a falsish value),<br>  :server-error/unable-to-populate-data<br>  (The 'populate-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-postpare-data<br>  (The 'postpare-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-prepare-data<br>  (The 'prepare-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-unparse-values<br>  (The 'unparse-values-f' function has been returned a falsish value),<br>  :server-error/unable-to-validate-data<br>  (The 'data-valid-f' function has been returned a falsish value)<br> :status (integer)<br>  200, 400, 403, 429, 500, 520}</pre></div></div><div class="content-block--separator"></div><div class="collapsible-wrapper" data-expanded="false" id="get-data-source-code"><pre class="collapsible-button text--xs text--semi-bold" onClick="toggleCollapsible(&apos;get-data-source-code&apos;)">Source Code</pre><pre class="collapsible-content content-block--boxed text-s scroll-x">(defn get-data<br>  ([request functions]<br>   (get-data request nil functions))<br><br>  ([request initial-data {:keys [additional-action-f<br>                                 additional-security-f<br>                                 client-rate-limit-exceeded-f<br>                                 data-valid-f<br>                                 get-data-f<br>                                 hide-sensitive-values-f<br>                                 parse-values-f<br>                                 permission-granted-f<br>                                 populate-data-f<br>                                 postpare-data-f<br>                                 prepare-data-f<br>                                 unparse-values-f<br>                                 user-rate-limit-exceeded-f]}]<br>   (let [ip-address (http/request->ip-address request)<br>         user-agent (http/request->user-agent request)]<br>        (cond (not (audit/ip-address-valid? ip-address))                                  {:body :invalid-request/invalid-ip-address             :status 400}<br>              (not (audit/user-agent-valid? user-agent))                                  {:body :invalid-request/invalid-user-agent             :status 400}<br>              (and client-rate-limit-exceeded-f (boolean (client-rate-limit-exceeded-f))) {:body :too-many-requests/client-rate-limit-exceeded   :status 429}<br>              (and user-rate-limit-exceeded-f   (boolean (user-rate-limit-exceeded-f)))   {:body :too-many-requests/user-rate-limit-exceeded     :status 429}<br>              (and permission-granted-f         (not (permission-granted-f)))             {:body :forbidden-request/permission-denied            :status 403}<br>              (and additional-security-f        (not (additional-security-f)))            {:body :unknown-error/additional-security-stage-failed :status 520}<br>              (and additional-action-f          (not (additional-action-f)))              {:body :unknown-error/additional-action-stage-failed   :status 520}<br>              :getting-data <br>                            (letfn [(apply-cascade-f [f data] (if f (f  data) data))]<br>                                   (as-> initial-data % (or (apply-cascade-f get-data-f              %) {:body :server-error/unable-to-get-data              :status 500})<br>                                                        (or (apply-cascade-f data-valid-f            %) {:body :server-error/unable-to-validate-data         :status 500})<br>                                                        (or (apply-cascade-f prepare-data-f          %) {:body :server-error/unable-to-prepare-data          :status 500})<br>                                                        (or (apply-cascade-f populate-data-f         %) {:body :server-error/unable-to-populate-data         :status 500})<br>                                                        (or (apply-cascade-f hide-sensitive-values-f %) {:body :server-error/unable-to-hide-sensitive-values :status 500})<br>                                                        (or (apply-cascade-f parse-values-f          %) {:body :server-error/unable-to-parse-values          :status 500})<br>                                                        (or (apply-cascade-f unparse-values-f        %) {:body :server-error/unable-to-unparse-values        :status 500})<br>                                                        (or (apply-cascade-f postpare-data-f         %) {:body :server-error/unable-to-postpare-data         :status 500})<br>                                                        {:body % :status 200}))))))</pre></div></div><div class="declaration--wrapper" id="store-data"><pre class="color--muted text--xs">Declaration</pre><pre class="color--primary declaration--name text--bold">store-data</pre><div class="content-blocks"><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Important</pre></div><pre class="color--warning text--m text--wrap">This function is incomplete and may not behave as expected.</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Description</pre></div><pre class="color--basic text--m text--wrap">- Security protocol function for storing data in the database.<br>- For performing additional side effects use the 'additional-action-f' function.<br>- For implementing additional security levels use the 'additional-security-f' function.<br>- Performs various security checks before returns a HTTP response that indicates if any check has been failed or the action was successful.<br>- The data validating / manipulating functions are applied as a cascade where every function takes the data as it has returned from<br>  the previous function (except the first function that takes the initial data) and every function must return the validated / manipulated<br>  data in case of successful execution.<br>  Functions are applied in the following order:<br>  1. data-valid-f<br>  2. prepare-data-f<br>  3. unpopulate-data-f<br>  4. remove-blank-values-f<br>  5. parse-values-f<br>  6. unparse-values-f<br>  7. postpare-data-f<br>  8. store-data-f</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">request</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs">required</pre></div></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">initial-data</pre><pre class="color--muted text--xs">*</pre><pre class="color--muted text--xs">optional</pre></div><pre class="color--muted text--s scroll-x">The 'initial-data' passed through the data validating / manipulating functions (that are applied as a cascade).<br>Default: NIL</pre></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">functions</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs">required</pre></div><pre class="color--muted text--s scroll-x">{:additional-action-f (function)(opt)<br>  Custom side-effect function that is applied if no security check has been failed.<br>  Must return TRUE in case of successful execution.<br> :additional-security-f (function)(opt)<br>  Custom security function that is applied after the built-in security checks.<br>  Must return TRUE in case of no security concern detected.<br> :client-rate-limit-exceeded-f (function)(opt)<br>  Must return TRUE if the client device / IP address is involved in too many attempts in a specific timeframe.<br> :data-valid-f (function)(opt)<br>  Takes the provided 'initial-data' as its only argument.<br>  Must return the data only if it's valid.<br> :parse-values-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :permission-granted-f (function)(opt)<br>  Must return TRUE if the user has permission to do the action.<br> :postpare-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :prepare-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :remove-blank-values-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :store-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return TRUE if the execution was successful.<br> :unparse-values-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :unpopulate-data-f (function)(opt)<br>  Takes the provided 'initial-data' (as the previous function returned it) as its only argument.<br>  Must return the data if the execution was successful.<br> :user-rate-limit-exceeded-f (function)(opt)<br>  Must return TRUE if the user is involved in too many attempts in a specific timeframe.}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Usage</pre></div><pre class="text--s scroll-x content-block--boxed">(store-data {...} {...})</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Usage</pre></div><pre class="text--s scroll-x content-block--boxed">(store-data {...} {...} {...})</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--warning text--xs">Unknown syntax</pre></div><pre class="color--muted text--m scroll-x">{:type :example, :indent 1, :additional ["(store-data {...} {...} {...})" "=>" "{:body :too-many-requests/user-rate-limit-exceeded :status 429}"]}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--warning text--xs">Unknown syntax</pre></div><pre class="color--muted text--m scroll-x">{:type :example, :indent 1, :additional ["(defn my-route" "  [request]" "  (let [ip-address (-> request :remote-addr)" "        user-id    (-> request :session :user-id)]" "       (store-data request {:my-string \"My string\"}" "                           {:client-rate-limit-exceeded-f #(my-log-service/too-many-attempts-by-ip-address? ip-address)" "                            :data-valid-f                 #(and (map? %) %)" "                            :parse-values-f               #(my-utils/parse-timestamps-in-data   %)" "                            :store-data-f                 #(my-database/store-data!             %)" "                            :unpopulate-data-f            #(my-utils/remove-user-related-values %)" "                            :user-rate-limit-exceeded-f   #(my-log-service/too-many-attempts-by-user-id? user-id)})))" "=>" "{:body :performed-request/data-stored :status 200}"]}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Return</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs"></pre></div><pre class="color--muted text--s scroll-x">{:body (namespaced keyword)<br>  :forbidden-request/permission-denied<br>  (The user has no permission to do the action),<br>  :invalid-request/invalid-ip-address<br>  (No valid IP address has been found in the request),<br>  :invalid-request/invalid-user-agent<br>  (No valid user agent has been found in the request),<br>  :performed-request/data-stored<br>  (The provided data has been successfully stored)<br>  :server-error/unable-to-parse-values<br>  (The 'parse-values-f' function has been returned a falsish value),<br>  :server-error/unable-to-postpare-data<br>  (The 'postpare-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-prepare-data<br>  (The 'prepare-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-remove-blank-values<br>  (The 'remove-blank-values-f' function has been returned a falsish value),<br>  :server-error/unable-to-store-data<br>  (The 'store-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-unparse-values<br>  (The 'unparse-values-f' function has been returned a falsish value),<br>  :server-error/unable-to-unpopulate-data<br>  (The 'unpopulate-data-f' function has been returned a falsish value),<br>  :server-error/unable-to-validate-data<br>  (The 'data-valid-f' function has been returned a falsish value),<br>  :too-many-requests/client-rate-limit-exceeded<br>  (Too many actions have been attempted by the client device / IP address in a specific timeframe),<br>  :too-many-requests/user-rate-limit-exceeded<br>  (Too many actions have been attempted by the user in a specific timeframe),<br>  :unknown-error/additional-action-stage-failed<br>  (The additional action function returned a false value),<br>  :unknown-error/additional-security-stage-failed<br>  (The additional security function returned a false value)<br> :status (integer)<br>  200, 400, 403, 429, 500, 520}</pre></div></div><div class="content-block--separator"></div><div class="collapsible-wrapper" data-expanded="false" id="store-data-source-code"><pre class="collapsible-button text--xs text--semi-bold" onClick="toggleCollapsible(&apos;store-data-source-code&apos;)">Source Code</pre><pre class="collapsible-content content-block--boxed text-s scroll-x">(defn store-data<br>  ([request functions]<br>   (store-data request nil functions))<br><br>  ([request initial-data {:keys [additional-action-f<br>                                 additional-security-f<br>                                 client-rate-limit-exceeded-f<br>                                 data-valid-f<br>                                 parse-values-f<br>                                 permission-granted-f<br>                                 postpare-data-f<br>                                 prepare-data-f<br>                                 remove-blank-values-f<br>                                 store-data-f<br>                                 unparse-values-f<br>                                 unpopulate-data-f<br>                                 user-rate-limit-exceeded-f]}]<br>   (let [ip-address (http/request->ip-address request)<br>         user-agent (http/request->user-agent request)]<br>        (cond (not (audit/ip-address-valid? ip-address))                                  {:body :invalid-request/invalid-ip-address             :status 400}<br>              (not (audit/user-agent-valid? user-agent))                                  {:body :invalid-request/invalid-user-agent             :status 400}<br>              (and client-rate-limit-exceeded-f (boolean (client-rate-limit-exceeded-f))) {:body :too-many-requests/client-rate-limit-exceeded   :status 429}<br>              (and user-rate-limit-exceeded-f   (boolean (user-rate-limit-exceeded-f)))   {:body :too-many-requests/user-rate-limit-exceeded     :status 429}<br>              (and permission-granted-f         (not (permission-granted-f)))             {:body :forbidden-request/permission-denied            :status 403}<br>              (and additional-security-f        (not (additional-security-f)))            {:body :unknown-error/additional-security-stage-failed :status 520}<br>              (and additional-action-f          (not (additional-action-f)))              {:body :unknown-error/additional-action-stage-failed   :status 520}<br>              :storing-data <br>                            (letfn [(apply-cascade-f [f data] (if f (f  data) data))]<br>                                   (as-> initial-data % (or (apply-cascade-f data-valid-f          %) {:body :server-error/unable-to-validate-data       :status 500})<br>                                                        (or (apply-cascade-f prepare-data-f        %) {:body :server-error/unable-to-prepare-data        :status 500})<br>                                                        (or (apply-cascade-f unpopulate-data-f     %) {:body :server-error/unable-to-unpopulate-data     :status 500})<br>                                                        (or (apply-cascade-f remove-blank-values-f %) {:body :server-error/unable-to-remove-blank-values :status 500})<br>                                                        (or (apply-cascade-f parse-values-f        %) {:body :server-error/unable-to-parse-values        :status 500})<br>                                                        (or (apply-cascade-f unparse-values-f      %) {:body :server-error/unable-to-unparse-values      :status 500})<br>                                                        (or (apply-cascade-f postpare-data-f       %) {:body :server-error/unable-to-postpare-data       :status 500})<br>                                                        (or (apply-cascade-f store-data-f          %) {:body :server-error/unable-to-store-data          :status 500})<br>                                                        {:body :performed-request/data-stored :status 200}))))))</pre></div></div><div class="declaration--wrapper" id="remove-data"><pre class="color--muted text--xs">Declaration</pre><pre class="color--primary declaration--name text--bold">remove-data</pre><div class="content-blocks"><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Important</pre></div><pre class="color--warning text--m text--wrap">This function is incomplete and may not behave as expected.</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Description</pre></div><pre class="color--basic text--m text--wrap">- Security protocol function for removing data from the database.<br>- For performing additional side effects use the 'additional-action-f' function.<br>- For implementing additional security levels use the 'additional-security-f' function.<br>- Performs various security checks before returns a HTTP response that indicates if any check has been failed or the action was successful.</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">request</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs">required</pre></div></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Param</pre><pre class="color--default text-s">functions</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs">required</pre></div><pre class="color--muted text--s scroll-x">{:additional-action-f (function)(opt)<br>  Custom side-effect function that is applied if no security check has been failed.<br>  Must return TRUE in case of successful execution.<br> :additional-security-f (function)(opt)<br>  Custom security function that is applied after the built-in security checks.<br>  Must return TRUE in case of no security concern detected.<br> :client-rate-limit-exceeded-f (function)(opt)<br>  Must return TRUE if the client device / IP address is involved in too many attempts in a specific timeframe.<br> :remove-data-f (function)<br>  Must return TRUE if the execution was successful.<br> :user-rate-limit-exceeded-f (function)(opt)<br>  Must return TRUE if the user is involved in too many attempts in a specific timeframe.}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Usage</pre></div><pre class="text--s scroll-x content-block--boxed">(remove-data {...} {...})</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--warning text--xs">Unknown syntax</pre></div><pre class="color--muted text--m scroll-x">{:type :example, :indent 1, :additional ["(remove-data {...} {...})" "=>" "{:body :too-many-requests/user-rate-limit-exceeded :status 429}"]}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--warning text--xs">Unknown syntax</pre></div><pre class="color--muted text--m scroll-x">{:type :example, :indent 1, :additional ["(defn my-route" "  [request]" "  (let [ip-address (-> request :remote-addr)" "        user-id    (-> request :session :user-id)]" "       (remove-data request {:client-rate-limit-exceeded-f #(my-log-service/too-many-attempts-by-ip-address? ip-address)" "                             :remove-data-f                #(my-database/remove-data!)" "                             :user-rate-limit-exceeded-f   #(my-log-service/too-many-attempts-by-user-id? user-id)})))" "=>" "{:body :performed-request/data-removed :status 200}"]}</pre></div><div class="content-block--separator"></div><div class="content-block"><div class="content-block--label"><pre class="color--muted text--xs">Return</pre><pre class="color--muted text--xs">map</pre><pre class="color--muted text--xs"></pre></div><pre class="color--muted text--s scroll-x">{:body (namespaced keyword)<br>  :forbidden-request/permission-denied<br>  (The user has no permission to do the action),<br>  :invalid-request/invalid-ip-address<br>  (No valid IP address has been found in the request),<br>  :invalid-request/invalid-user-agent<br>  (No valid user agent has been found in the request),<br>  :performed-request/data-removed<br>  (The data has been successfully removed)<br>  :server-error/unable-to-remove-data<br>  (The 'remove-data-f' function has been returned a falsish value),<br>  :too-many-requests/client-rate-limit-exceeded<br>  (Too many actions have been attempted by the client device / IP address in a specific timeframe),<br>  :too-many-requests/user-rate-limit-exceeded<br>  (Too many actions have been attempted by the user in a specific timeframe),<br>  :unknown-error/additional-action-stage-failed<br>  (The additional action function returned a false value),<br>  :unknown-error/additional-security-stage-failed<br>  (The additional security function returned a false value)<br> :status (integer)<br>  200, 400, 403, 429, 500, 520}</pre></div></div><div class="content-block--separator"></div><div class="collapsible-wrapper" data-expanded="false" id="remove-data-source-code"><pre class="collapsible-button text--xs text--semi-bold" onClick="toggleCollapsible(&apos;remove-data-source-code&apos;)">Source Code</pre><pre class="collapsible-content content-block--boxed text-s scroll-x">(defn remove-data<br>  [request {:keys [additional-action-f<br>                   additional-security-f<br>                   client-rate-limit-exceeded-f<br>                   permission-granted-f<br>                   remove-data-f<br>                   user-rate-limit-exceeded-f]}]<br>  (let [ip-address (http/request->ip-address request)<br>        user-agent (http/request->user-agent request)]<br>       (cond (not (audit/ip-address-valid? ip-address))                                  {:body :invalid-request/invalid-ip-address             :status 400}<br>             (not (audit/user-agent-valid? user-agent))                                  {:body :invalid-request/invalid-user-agent             :status 400}<br>             (and client-rate-limit-exceeded-f (boolean (client-rate-limit-exceeded-f))) {:body :too-many-requests/client-rate-limit-exceeded   :status 429}<br>             (and user-rate-limit-exceeded-f   (boolean (user-rate-limit-exceeded-f)))   {:body :too-many-requests/user-rate-limit-exceeded     :status 429}<br>             (and permission-granted-f         (not (permission-granted-f)))             {:body :forbidden-request/permission-denied            :status 403}<br>             (and additional-security-f        (not (additional-security-f)))            {:body :unknown-error/additional-security-stage-failed :status 520}<br>             (and additional-action-f          (not (additional-action-f)))              {:body :unknown-error/additional-action-stage-failed   :status 520}<br>             (not (remove-data-f))                                                       {:body :server-error/unable-to-remove-data             :status 500}<br>             :data-removed                                                               {:body :performed-request/data-removed                 :status 200})))</pre></div></div></div></div><div id="top-bar"><pre class="text--bold" id="top-bar--library-name">clj-security-protocols</pre><pre class="color--muted" id="top-bar--library-version">0.0.8.2</pre><a href="https://github.com/mt-app-kit/clj-security-protocols" id="top-bar--library-uri"><pre class="color--primary">github.com/mt-app-kit/clj-security-protocols</pre></a></div><div id="bottom-bar"><a href="https://github.com/mt-devtools/clj-source-code-documentation" id="bottom-bar--credits-link"><pre>github.com/mt-devtools/clj-source-code-documentation</pre></a></div></body></html></html>
